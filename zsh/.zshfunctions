# vim : filetype=zsh
sleepuntil () {
    if [[ "$#" != 1 ]] ; then echo "Usage: sleepuntil timestamp" ; return 1 ; fi
    local then="$(date -d "$1" +%s)"
    local now="$(date +%s)"
    sleep "$(( $then - $now ))"
}

xargsvim () {
    xargs "$@" "$SHELL" -c '</dev/tty vim "$@"' ignoreme
}

shtart () {
    nohup $@ >/dev/null 2>&1 &!
}

compdef _shtart shtart
_shtart () {
    local -a args
    args=(
        '(-)1:command: _command_names -e'
        '*::arguments:{_normal}'
    )
    _arguments -s -S $args
}

grep () {
    eval set -A args $(getopt --longoptions recursive,dereference-recursive --options rR --quiet -- "$@")
    [[ "${args[1]}" != -- ]] && { printf "using %s with grep is forbidden!\n" "${args[1]}" ; return 1 }
    command grep "$@"
}

cat () {
    if [ -t 1 ] && command -v lolcat >&- ; then lolcat "$@" ; else command cat "$@" ; fi
}

sudo () {
    case $1 in
    kak|k|vim) shift ; sudoedit "$@" ;;
    *) command sudo "$@" ;;
    esac
}
